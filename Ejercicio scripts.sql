-- Creación de la base de datos
DROP DATABASE IF EXISTS agencia_de_viajes;
CREATE DATABASE agencia_de_viajes;

USE agencia_de_viajes;

CREATE TABLE CLIENTE(
	DNI VARCHAR(9),
	NOMBRE VARCHAR(20),
	APELLIDO VARCHAR(20),
	FECHA_NACIMIENTO DATE,
	EMAIL varchar(50),
	TELEFONO INT
);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLI PRIMARY KEY (DNI);

CREATE TABLE ALOJAMIENTO(
	NOMBRE VARCHAR(20),
	TIPO VARCHAR(20), -- Posibles tipos: Hotel, Apartamento, Hostal, Camping.
	DIRECCION VARCHAR(50),
	LOCALIDAD VARCHAR(50)
);

ALTER TABLE ALOJAMIENTO ADD CONSTRAINT PK_ALO PRIMARY KEY (NOMBRE, TIPO);

CREATE TABLE VIAJE(
	DNI_CLIENTE VARCHAR(9),
	NOMBRE_ALOJAMIENTO VARCHAR(50),
	TIPO_ALOJAMIENTO VARCHAR(20), -- Posibles tipos: Hotel, Apartamento, Hostal, Camping.
	LOCALIDAD VARCHAR(50),
	FECHA_SALIDA DATETIME,
	FECHA_VUELTA DATETIME
);

ALTER TABLE VIAJE ADD CONSTRAINT PK_VIJ PRIMARY KEY (DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA);
ALTER TABLE VIAJE ADD CONSTRAINT FK_VIJ_CLI FOREIGN KEY (DNI_CLIENTE) REFERENCES CLIENTE(DNI);
ALTER TABLE VIAJE ADD CONSTRAINT FK_VIJ_ALO FOREIGN KEY (NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO) REFERENCES ALOJAMIENTO(NOMBRE, TIPO);

CREATE TABLE ATRACCION_TURISTICA(
	LOCALIDAD VARCHAR(50),
	NOMBRE VARCHAR(50),
	CAPACIDAD INT,
	DURACION INT,
	HORARIO JSON
);

ALTER TABLE ATRACCION_TURISTICA ADD CONSTRAINT PK_ATT PRIMARY KEY (LOCALIDAD, NOMBRE);
ALTER TABLE ATRACCION_TURISTICA ADD CONSTRAINT CH_ATT_HORARIO CHECK (JSON_VALID(HORARIO));

CREATE TABLE VISITA(
	DNI_CLIENTE VARCHAR(9),
	NOMBRE_ALOJAMIENTO VARCHAR(50),
	TIPO_ALOJAMIENTO VARCHAR(20), -- Posibles tipos: Hotel, Apartamento, Hostal, Camping.
	LOCALIDAD_VIAJE VARCHAR(50),
	FECHA_SALIDA_VIAJE DATETIME,
	LOCALIDAD_ATRACCION_TURISTICA VARCHAR(50),
	NOMBRE_ATRACCION_TURISTICA VARCHAR(50),
	HORA_INICIO DATETIME
);

ALTER TABLE VISITA ADD CONSTRAINT PK_VIS PRIMARY KEY (DNI_CLIENTE, LOCALIDAD_ATRACCION_TURISTICA, NOMBRE_ATRACCION_TURISTICA);
ALTER TABLE VISITA ADD CONSTRAINT FK_VIS_VIJ FOREIGN KEY (DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD_VIAJE, FECHA_SALIDA_VIAJE) REFERENCES VIAJE(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA);
ALTER TABLE VISITA ADD CONSTRAINT FK_VIS_ATT FOREIGN KEY (LOCALIDAD_ATRACCION_TURISTICA, NOMBRE_ATRACCION_TURISTICA) REFERENCES ATRACCION_TURISTICA(LOCALIDAD, NOMBRE);

-- Inserción de datos
-- Clientes
INSERT INTO CLIENTE (DNI, NOMBRE, APELLIDO, FECHA_NACIMIENTO, EMAIL, TELEFONO)
VALUES('28395745J', 'Juan', 'Pérez', '1968-04-14', 'juanperez@gmail.com', 674978467);
INSERT INTO CLIENTE (DNI, NOMBRE, APELLIDO, FECHA_NACIMIENTO, EMAIL, TELEFONO)
VALUES('96748012M', 'María', 'Martínez', '1995-07-12', 'mariamartinez@gmail.com', 684078134);
INSERT INTO CLIENTE (DNI, NOMBRE, APELLIDO, FECHA_NACIMIENTO, EMAIL, TELEFONO)
VALUES('98885533K', 'Pedro', 'Fernández', '1958-11-27', 'pedrofernandez@gmail.com', 659378811);
INSERT INTO CLIENTE (DNI, NOMBRE, APELLIDO, FECHA_NACIMIENTO, EMAIL, TELEFONO)
VALUES('18276309L', 'Azucena', 'Dueñas', '1950-2-8', 'azucenadueñas@gmail.com', 684078134);

-- Alojamientos
INSERT INTO ALOJAMIENTO (NOMBRE, TIPO, DIRECCION, LOCALIDAD)
VALUES('El Marqués', 'Hotel', 'Paseo Alejandra, 653, Bajo 6º', 'Barcelona');
INSERT INTO ALOJAMIENTO (NOMBRE, TIPO, DIRECCION, LOCALIDAD)
VALUES('Como en casa', 'Hostal', 'Calle Hoja, 200', 'Logroño');
INSERT INTO ALOJAMIENTO (NOMBRE, TIPO, DIRECCION, LOCALIDAD)
VALUES('Final del camino', 'Apartamento', 'Calle Las Ventas, 48', 'Santiago de Compostela');
INSERT INTO ALOJAMIENTO (NOMBRE, TIPO, DIRECCION, LOCALIDAD)
VALUES('Las Endrinas', 'Camping', 'Avenida Quinto Canal, 23', 'Tarragona');

-- Viajes
INSERT INTO VIAJE(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA, FECHA_VUELTA)
VALUES('18276309L', 'Como en casa', 'Hostal', 'Logroño', '2023-02-03 14:00:00.000', '2023-02-12 21:00:00.000');
INSERT INTO VIAJE(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA, FECHA_VUELTA)
VALUES('28395745J', 'El Marqués', 'Hotel', 'Barcelona', '2022-12-24 14:00:00.000', '2023-12-27 21:00:00.000');
INSERT INTO VIAJE(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA, FECHA_VUELTA)
VALUES('96748012M', 'Final del camino', 'Apartamento', 'Santiago de Compostela', '2023-01-01 14:00:00.000', '2023-01-08 21:00:00.000');
INSERT INTO VIAJE(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD, FECHA_SALIDA, FECHA_VUELTA)
VALUES('98885533K', 'Las Endrinas', 'Camping', 'Tarragona', '2023-01-01 14:00:00.000', '2023-01-08 21:00:00.000');

-- Atracciones turísticas
INSERT INTO ATRACCION_TURISTICA(LOCALIDAD, NOMBRE, CAPACIDAD, DURACION, HORARIO)
VALUES('Logroño', 'Museo del Vino', 5, 1, '{"lunes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"martes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"miércoles":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"jueves":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"viernes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"sábado":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"domingo":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"}}');
INSERT INTO ATRACCION_TURISTICA(LOCALIDAD, NOMBRE, CAPACIDAD, DURACION, HORARIO)
VALUES('Santiago', 'Catedral', 10, 2, '{"lunes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"martes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"miércoles":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"jueves":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"viernes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"sábado":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"domingo":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"}}');
INSERT INTO ATRACCION_TURISTICA(LOCALIDAD, NOMBRE, CAPACIDAD, DURACION, HORARIO)
VALUES('Tarragona', 'Museo Nacional Arqueológico', 7, 2, '{"lunes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"martes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"miércoles":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"jueves":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"viernes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"sábado":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"domingo":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"}}');
INSERT INTO ATRACCION_TURISTICA(LOCALIDAD, NOMBRE, CAPACIDAD, DURACION, HORARIO)
VALUES('Barcelona', 'La Sagrada Familia', 10, 2, '{"lunes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"martes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"miércoles":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"jueves":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"viernes":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"sábado":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"},"domingo":{"mañana": "10:00 - 14:00","tarde": "17:00 - 21:00"}}');

-- Visitas
INSERT INTO VISITA(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD_VIAJE, FECHA_SALIDA_VIAJE, LOCALIDAD_ATRACCION_TURISTICA, NOMBRE_ATRACCION_TURISTICA, HORA_INICIO)
VALUES('18276309L', 'Como en casa', 'Hostal', 'Logroño', '2023-02-03 14:00:00.000', 'Logroño', 'Museo del Vino', '2023-02-05 11:00:00.000');
INSERT INTO VISITA(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD_VIAJE, FECHA_SALIDA_VIAJE, LOCALIDAD_ATRACCION_TURISTICA, NOMBRE_ATRACCION_TURISTICA, HORA_INICIO)
VALUES('28395745J', 'El Marqués', 'Hotel', 'Barcelona', '2022-12-24 14:00:00.000', 'Tarragona', 'Museo Nacional Arqueológico', '2022-12-26 13:00:00.000');
INSERT INTO VISITA(DNI_CLIENTE, NOMBRE_ALOJAMIENTO, TIPO_ALOJAMIENTO, LOCALIDAD_VIAJE, FECHA_SALIDA_VIAJE, LOCALIDAD_ATRACCION_TURISTICA, NOMBRE_ATRACCION_TURISTICA, HORA_INICIO)
VALUES('28395745J', 'El Marqués', 'Hotel', 'Barcelona', '2022-12-24 14:00:00.000', 'Barcelona', 'La Sagrada Familia', '2022-12-25 18:00:00.000');








